<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Генератор расписания трамваев</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="total">
    <h2>Генерация расписания</h2>
    <form method="POST">
        <label>Время начала (ЧЧ:ММ): <input id="start_time" type="time" required name="start_time"
                                            value="{{ request.form.start_time or '04:48' }}"></label><br>
        <label>Время окончания (ЧЧ:ММ): <input id="end_time" type="time" required name="end_time"
                                               value="{{ request.form.end_time or '01:34' }}"></label><br>
        <label>Время смены (ЧЧ:ММ): <input id="change_time" type="time" required name="change_time" value="{{ request.form.change_time or '13:36' }}"></label><br>
        <label>Мин. норма (ч): <input name="min_norm_work" type="number" step="0.1"
                                      value="{{ request.form.min_norm_work or 6 }}"></label><br>
        <label>Макс. норма (ч): <input name="max_norm_work" type="number" step="0.1"
                                       value="{{ request.form.max_norm_work or 10 }}"></label><br>
        <button type="submit">Сгенерировать</button>
    </form>

    {% if result %}
    <h3>Результат:</h3>
    <p>Водителей: {{ result.num_drivers }}</p>
    <p>Рейсов: {{ result.total_drives }}</p>
    <p>Последний возврат: {{ result.last_return_time }}</p>
    
    <div class="tables-container">
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('schedule', this)">Расписание рейсов</button>
            <button class="tab-button" onclick="showTab('worktime', this)">Время работы водителей</button>
            <button class="tab-button" onclick="showTab('text', this)">Текстовые файлы</button>
        </div>
        
        <div id="schedule-tab" class="tab-content active">
            <div class="table-controls">
                <input type="text" id="schedule-search" placeholder="Поиск по водителю или рейсу..." onkeyup="filterScheduleTable()">
                <button onclick="exportTable('schedule')">Экспорт в CSV</button>
            </div>
            <div class="table-wrapper">
                <table id="schedule-table" class="data-table">
                    <thead>
                        <tr>
                            <th>№ Рейса</th>
                            <th>Водитель</th>
                            <th>Старт в парке</th>
                            <th>Прибытие на конечную</th>
                            <th>Старт с конечной</th>
                            <th>Возврат в парк</th>
                            <th>Набранные часы</th>
                            <th>Норма достигнута</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-tbody">
                        <!-- Данные загружаются через JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="worktime-tab" class="tab-content">
            <div class="table-controls">
                <input type="text" id="worktime-search" placeholder="Поиск по водителю..." onkeyup="filterWorktimeTable()">
                <select id="worktime-filter" onchange="filterWorktimeTable()">
                    <option value="all">Все водители</option>
                    <option value="normal">Норма достигнута</option>
                    <option value="underworked">Недоработка/Переработка</option>
                </select>
                <button onclick="exportTable('worktime')">Экспорт в CSV</button>
            </div>
            <div class="table-wrapper">
                <table id="worktime-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Водитель</th>
                            <th>Время начала</th>
                            <th>Время окончания</th>
                            <th>Длительность</th>
                            <th>Статус</th>
                            <th>Перерыв</th>
                            <th>Сможет выйти</th>
                        </tr>
                    </thead>
                    <tbody id="worktime-tbody">
                        <!-- Данные загружаются через JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="text-tab" class="tab-content">
            <div class="text-files-container">
                <a href="/output_files/schedule_one.txt" target="_blank" class="file-button">Посмотреть расписание (текст)</a>
                <a href="/output_files/worktime_one.txt" target="_blank" class="file-button">Посмотреть время работы (текст)</a>
                <a href="/output_files/stats.txt" target="_blank" class="file-button">Посмотреть статистику (текст)</a>
            </div>
        </div>
    </div>
    {% endif %}

    {% if error %}
    <h3 style="color: red;">Ошибка:</h3>
    <pre>{{ error }}</pre>
    <a href="/">Назад</a>
    {% endif %}
</div>
<script src="script.js"></script>
</body>
</html>